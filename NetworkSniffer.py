import time
from scapy.all import *
from scapy.layers.http import HTTPRequest
import argparse

GREEN = '\u001b[32m'
RESET = '\033[0m'

def sniff_packets(interface, filter_protocol=None):
    print(GREEN + "Sniffing on interface " + interface + "\n\n" + RESET)

    def process_packet(packet):
        if packet.haslayer(IP):
            src_ip = packet[IP].src
            dst_ip = packet[IP].dst
            protocol = packet[IP].proto
            print(f"IP Packet: {src_ip} => {dst_ip}, Protocol: {protocol}")

        if packet.haslayer(HTTPRequest):
            method = packet[HTTPRequest].Method.decode()
            host = packet[HTTPRequest].Host.decode()
            path = packet[HTTPRequest].Path.decode()
            print(f"HTTP Request: {method} {host}{path}")

        if packet.haslayer(Raw):
            payload = packet[Raw].load[:100]
            print(f"Raw Payload: {payload}")

    sniff (iface=interface, prn=process_packet, filter=filter_protocol, store=False)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Sniff network packets.")
    parser.add_argument("-i", "--interface", required=True, help="Network interface to sniff on.")
    parser.add_argument("-f", "--filter", help="BPF filter for packet sniffing (optional)")
    args = parser.parse_args()

    print(GREEN + """ 
                ................................................:::-:.................... . --:.....................
		..........:::::...........::::::::::--======.##########.======---------==.. ===:-:..................
		====-:-----=============================##########.##=.. ================.. ===-----:::::...........
		======================================############..#=    ===============.. ==.=====================
		====================================############....#.    ===============.. ==.=====================
		=================================##############  #.        ==============.. ========================
		==============================.  ############=   #.         =============#. ========================
		================================.     ###.#.#.  #.           ============.. ========================
		=================================       .#..#  ..             ===========.. ========================
		=================================         ..                  ==========-##.========================
		=================================@          .                  =========.#  ========================
		==================================.         .                    =======..   =======================
		===================================#         .      #.            ======@.   =======================
		======-============================@         #    #.   ##.         ======.  ========================
		==..##..#######............=========#         .  .  #####....       -=.==    =.=====================
		==..######@###########################        . ##### ##....         =  =   ##==#..######........===
		==..###=@=@###########################       ####.##.   .               .   #@.##################===
		==..###===#############################     #=#######=  .:                  =. .#############===@===
		==..###=################################    ######     .                    = =####..#######====*@==
		==..###.################################    .    = ==  =-                      .############=====@==
		*=..###=#@##############################            =  =                       =-###########========
		@=..###=##.#############################     #.# ..   .=                        ############====@===
		@=..###=###############################*    ### #.                             .############====@===
		@=..###=##.############################.    ### #. .                            #################===
		@=..###=##=############################=   @.# #.  .                             ################===
		@=..###=##################################### ##=                                ##############=#===
		@=..###=###############.=########@######  #.###..                               .###########@====@@@
		@=..###=############..## .## ######      ####                                    ###########%====..:
		....###=##@@#######.......  #####   #   ##= #= =                                 .##########-.### ..
		....##############..     . :#=#..       #. =                                       ...--:...........
		.. .############. ..      # .####-       =.-  =                                    ##.....:.........
		..........###.  ....      .###.### #- ##  =                                      = #####.#=.........
		.............. .#......   . ####### #####.                                         .#....... ... ...
		............############   #. .#.   .==                                           .. .....##........
		...#########.##########:  #   ...  .                                               .#.+..-#..#......
		####################..  .#.     .  .                                              ...:.#............
		#......## #.....       ###                                                        ..................
		
			████████╗██╗  ██╗███████╗      ██████╗  ██████╗ ██╗  ██╗██████╗ ███████╗██████╗ 
			╚══██╔══╝██║  ██║██╔════╝      ██╔══██╗ ╚════██╗██║  ██║██╔══██╗██╔════╝██╔══██╗
			   ██║   ███████║█████╗ █████╗ ██████╔╝  █████╔╝███████║██████╔╝█████╗  ██████╔╝
			   ██║   ██╔══██║██╔══╝ ╚════╝ ██╔══██╗  ╚═══██╗╚════██║██╔═══╝ ██╔══╝  ██╔═██╗
			   ██║   ██║  ██║███████╗      ██║   ██║██████╔╝     ██║██║     ███████╗██║  ██║
			   ╚═╝   ╚═╝  ╚═╝╚══════╝      ╚═╝   ╚═╝╚═════╝      ╚═╝╚═╝     ╚══════╝╚═╝  ╚═╝
                                                        Network Sniffer
                                                      Created by The-R34per
                                        
                                                    Loading Network Sniffer...
        """)

    time.sleep(5)
    print("Sniffer Loaded Successfully...")
    time.sleep(2)
    print("Capturing Packets..." + RESET)
    time.sleep(2)

    try:
        sniff_packets(args.interface, args.filter)
    except PermissionError:
        print("Permission denied. Try running with sudo.")
    except Exception as e:
        print(f"An error occurred: {e}")
    except KeyboardInterrupt:
        print("\nPacket sniffing stopped by user.")



